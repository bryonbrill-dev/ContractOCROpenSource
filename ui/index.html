<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ContractOCR UI</title>
  <script>
    tailwind = window.tailwind || {};
    tailwind.config = { corePlugins: { preflight: false } };
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .row { display: flex; gap: 16px; }
    .row.wrap { flex-wrap: wrap; }
    .col { flex: 1; }
    .card { border: 1px solid #ddd; border-radius: 8px; padding: 12px; background: #fff; }
    .drop { border: 2px dashed #888; border-radius: 10px; padding: 18px; text-align: center; cursor: pointer; }
    .drop.drag { background: #f3f6ff; }
    table { width: 100%; border-collapse: collapse; }
    th, td { border-bottom: 1px solid #eee; padding: 8px; text-align: left; }
    .badge { padding: 3px 8px; border-radius: 999px; color: #fff; font-size: 12px; display: inline-block; }
    .green { background: #2e7d32; }
    .red { background: #c62828; }
    .yellow { background: #b26a00; }
    .muted { color: #666; font-size: 12px; }
    input, button, select { padding: 8px; }
    input, select { border: 1px solid #111; border-radius: 6px; background: #fff; }
    input:focus, select:focus { outline: 2px solid #111; outline-offset: 1px; }
    button { cursor: pointer; background: #0b3a6f; color: #fff; border: 1px solid #0b3a6f; border-radius: 6px; font-weight: 600; }
    button:hover { background: #f28c28; border-color: #f28c28; color: #fff; }
    button:focus { outline: 2px solid #ffffff; outline-offset: 1px; box-shadow: 0 0 0 3px rgba(11, 58, 111, 0.35); }
    a { text-decoration: underline; color: #1d4ed8; font-weight: 600; }
    .small { font-size: 12px; }
    pre { white-space: pre-wrap; word-break: break-word; }
    .hidden { display: none; }
    .nav { display: flex; gap: 10px; margin: 12px 0; }
    .nav button { border: 1px solid #0b3a6f; background: #ffffff; color: #0b3a6f; padding: 10px 14px; border-radius: 6px; font-weight: bold; }
    .nav button:hover { background: #f28c28; border-color: #f28c28; color: #ffffff; }
    .nav button.active { background: #0b3a6f; border-color: #0b3a6f; color: #ffffff; }
    .folder-list { display: flex; flex-direction: column; gap: 12px; margin-top: 10px; }
    .folder-card { border: 1px solid #dce1ff; border-radius: 10px; background: linear-gradient(135deg, #f8f9ff, #ffffff); box-shadow: 0 1px 4px rgba(0,0,0,0.06); }
    .folder-header { display: flex; justify-content: space-between; align-items: center; padding: 12px 14px; border-bottom: 1px solid #e6e9ff; }
    .folder-title { font-weight: bold; font-size: 16px; }
    .folder-body { padding: 10px 14px 12px 14px; border-left: 4px solid #c4cdfc; }
    .event-row { display: flex; gap: 12px; padding: 8px 6px; border-bottom: 1px dashed #e6e9ff; align-items: center; }
    .event-row:last-child { border-bottom: none; }
    .event-date { min-width: 110px; font-weight: bold; color: #2e3b8b; }
    .pill { background: #eef2ff; color: #2e3b8b; padding: 4px 8px; border-radius: 999px; font-size: 11px; border: 1px solid #d0d7ff; }
    .event-type { background: #e3f2fd; color: #1565c0; border-color: #bbdefb; }
    .status-smart { background: #dcfce7; color: #166534; border-color: #86efac; }
    .status-manual { background: #fef9c3; color: #854d0e; border-color: #fde047; }
    .status-inconclusive { background: #fee2e2; color: #991b1b; border-color: #fecaca; }
    .event-renewal { background: #ede9fe; color: #5b21b6; border-color: #c4b5fd; }
    .event-termination { background: #ffe4e6; color: #9f1239; border-color: #fecdd3; }
    .event-effective { background: #e0f2fe; color: #075985; border-color: #bae6fd; }
    .event-auto_opt_out { background: #fef3c7; color: #92400e; border-color: #fcd34d; }
    .legend { border: 1px solid #e5e7eb; border-radius: 8px; padding: 10px; background: #f8fafc; margin-top: 10px; }
    .legend-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 8px; margin-top: 8px; }
    .legend-item { display: flex; align-items: center; gap: 8px; font-size: 12px; color: #374151; }
    .filters label { display: flex; flex-direction: column; gap: 4px; font-size: 12px; color: #444; }
    .section { border: 1px solid #e5e7eb; border-radius: 8px; padding: 10px; margin-top: 10px; background: #f8fafc; }
    details.section { padding: 8px 10px; }
    details.section > summary { cursor: pointer; list-style: none; display: flex; justify-content: space-between; align-items: center; gap: 10px; }
    details.section > summary::-webkit-details-marker { display: none; }
    details.section > summary::marker { content: ""; }
    .summary-title { display: flex; align-items: center; gap: 6px; flex-wrap: wrap; font-weight: bold; }
    .summary-meta { display: inline-flex; align-items: center; gap: 8px; font-size: 12px; color: #6b7280; font-weight: normal; }
    .pill.tag { border-color: transparent; }
    .section h4 { margin: 0 0 6px 0; }
    .inline { display: inline-flex; gap: 8px; align-items: center; flex-wrap: wrap; }
    .muted-input { width: 100%; box-sizing: border-box; }
    .chip-btn { background: none; border: none; cursor: pointer; color: #b91c1c; margin-left: 6px; }
  </style>
</head>
<body>
  <h2>ContractOCR</h2>

  <div class="card">
    <div class="small muted">API Base</div>
    <input id="apiBase" style="width:360px" />
    <button id="saveApi">Save</button>
    <span class="muted small" id="apiStatus"></span>
  </div>

  <div class="nav">
    <button id="navContracts" class="active">Contracts</button>
    <button id="navAllContracts">All Contracts</button>
    <button id="navEvents">Events</button>
    <button id="navPlanner">Planner</button>
  </div>

  <div id="contractsPage">
    <div class="row" style="margin-top:16px">
      <div class="col">
        <div class="card">
          <h3 style="margin-top:0">Upload</h3>
          <div id="drop" class="drop">Drag & drop PDF(s) here, or click to choose</div>
          <input id="filePicker" type="file" multiple accept=".pdf,.png,.jpg,.jpeg,.tif,.tiff" style="display:none" />
          <div id="uploadLog" class="small muted" style="margin-top:10px"></div>
        </div>

        <div class="card" style="margin-top:16px">
          <div style="display:flex; justify-content:space-between; align-items:center;">
            <h3 style="margin:0">Recent Contracts</h3>
            <button id="refresh">Refresh</button>
          </div>
          <div class="muted small" style="margin-top:6px">Green = processed, Red = error, Yellow = processing</div>
          <details class="legend">
            <summary class="small">Color key</summary>
            <div class="legend-grid">
              <div class="legend-item"><span class="badge green">processed</span> Completed processing</div>
              <div class="legend-item"><span class="badge yellow">processing</span> OCR in progress</div>
              <div class="legend-item"><span class="badge red">error</span> Processing error</div>
              <div class="legend-item"><span class="pill status-smart">smart</span> High-confidence extraction</div>
              <div class="legend-item"><span class="pill status-manual">manual</span> Manually entered</div>
              <div class="legend-item"><span class="pill status-inconclusive">inconclusive</span> Low confidence</div>
              <div class="legend-item"><span class="pill event-type event-effective">effective</span> Key date</div>
              <div class="legend-item"><span class="pill event-type event-renewal">renewal</span> Renewal timeline</div>
              <div class="legend-item"><span class="pill event-type event-termination">termination</span> Termination date</div>
              <div class="legend-item"><span class="pill event-type event-auto_opt_out">auto opt-out</span> Notice deadline</div>
            </div>
            <div class="muted small" style="margin-top:6px;">Tag colors come from the tag settings.</div>
          </details>
          <table style="margin-top:10px">
            <thead>
              <tr>
                <th>Status</th>
                <th>Title</th>
                <th>Uploaded</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="contracts"></tbody>
          </table>
        </div>
      </div>

      <div class="col">
        <div class="card">
          <h3 style="margin-top:0">Contract Detail</h3>
          <div id="detail" class="muted">Click a contract to view terms/events.</div>
        </div>
      </div>
    </div>
  </div>

  <div id="eventsPage" class="hidden">
    <div class="card" style="margin-top:16px">
          <div style="display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;">
            <div>
              <h3 style="margin:0">Expiring Events</h3>
              <div class="muted small">Search and review renewal/termination timelines like nested folders.</div>
            </div>
            <div class="inline">
              <button id="eventsRefresh">Refresh</button>
              <button id="eventsExport">Export CSV</button>
            </div>
          </div>

          <div class="row wrap filters" style="margin-top:12px; gap:12px;">
            <label style="min-width:140px;">
              Month
              <input id="eventMonth" type="month" />
            </label>
            <label style="min-width:140px; align-items:center; flex-direction:row; gap:8px; margin-top:18px;">
              <input type="checkbox" id="eventAllMonths" />
              Show all months
            </label>
            <label style="min-width:160px;">
              Event Type
              <select id="eventTypeFilter">
                <option value="all">All types</option>
                <option value="renewal">Renewal</option>
            <option value="termination">Termination</option>
            <option value="auto_opt_out">Auto opt-out</option>
            <option value="effective">Effective</option>
          </select>
        </label>
        <label style="min-width:160px;">
          Sort
          <select id="eventSort">
            <option value="date_asc">Date ↑</option>
            <option value="date_desc">Date ↓</option>
            <option value="title_asc">Title A→Z</option>
            <option value="title_desc">Title Z→A</option>
          </select>
        </label>
        <label style="flex:1; min-width:200px;">
          Search contracts or event types
          <input id="eventSearch" type="text" placeholder="Search by contract, vendor, or event…" />
        </label>
        <label style="min-width:170px; align-items:center; flex-direction:row; gap:8px; margin-top:18px;">
          <input type="checkbox" id="expiringOnly" />
          Expiring-focused only
        </label>
      </div>

      <div class="muted small" id="eventsStatus" style="margin-top:4px"></div>
      <div id="eventsList" class="folder-list"></div>
    </div>
  </div>

  <div id="allContractsPage" class="hidden">
    <div class="card" style="margin-top:16px">
      <div style="display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;">
        <div>
          <h3 style="margin:0">All Contracts</h3>
          <div class="muted small">Search across titles, vendors, and filenames.</div>
        </div>
        <div class="inline">
          <button id="allRefresh">Refresh</button>
          <button id="allContractsExport">Export CSV</button>
          <button id="reprocessAll">Reprocess all</button>
        </div>
      </div>

      <div class="row wrap filters" style="margin-top:12px; gap:12px;">
        <label style="flex:1; min-width:240px;">
          Search
          <input id="allContractsSearch" type="text" placeholder="Search contracts..." />
        </label>
      </div>
      <div class="muted small" style="margin-top:6px;">
        Reprocess all runs OCR again for every contract and is not recommended for large databases.
      </div>
      <div class="muted small" id="allContractsStatus" style="margin-top:4px"></div>
      <table style="margin-top:10px">
        <thead>
          <tr>
            <th>Status</th>
            <th>Title</th>
            <th>Vendor</th>
            <th>Uploaded</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="allContractsTable"></tbody>
      </table>
      <div style="margin-top:10px;">
        <button id="allContractsLoadMore">Load more</button>
      </div>
    </div>
  </div>

  <div id="plannerPage" class="hidden">
    <div class="card" style="margin-top:16px">
      <div style="display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;">
        <div>
          <h3 style="margin:0">Event Planner</h3>
          <div class="muted small">Add or edit renewal timelines and events for any contract.</div>
        </div>
        <div class="inline">
          <button id="plannerRefresh">Refresh</button>
          <button id="plannerExport">Export CSV</button>
        </div>
      </div>

      <div class="row wrap filters" style="margin-top:12px; gap:12px;">
        <label style="min-width:200px;">
          Contract
          <select id="plannerContract"></select>
        </label>
        <label style="min-width:140px;">
          Event Type
          <select id="plannerEventType">
            <option value="renewal">Renewal</option>
            <option value="termination">Termination</option>
            <option value="effective">Effective</option>
            <option value="auto_opt_out">Auto opt-out</option>
            <option value="custom">Custom</option>
          </select>
        </label>
        <label style="min-width:160px;">
          Event Date
          <input type="date" id="plannerEventDate" />
        </label>
        <label style="flex:1; min-width:200px;">
          Custom Type (if chosen)
          <input type="text" id="plannerCustomType" placeholder="e.g., Notice" />
        </label>
        <button id="plannerAdd">Add Event</button>
      </div>

      <div class="row wrap filters" style="margin-top:8px; gap:12px;">
        <label style="min-width:160px;">
          Show Month
          <input type="month" id="plannerMonth" />
        </label>
        <label style="min-width:170px; align-items:center; flex-direction:row; gap:8px; margin-top:18px;">
          <input type="checkbox" id="plannerAllMonths" />
          Show all months
        </label>
      </div>

      <div class="muted small" id="plannerStatus" style="margin-top:4px"></div>
      <table style="width:100%; margin-top:10px; border-collapse:collapse;">
        <thead>
          <tr>
            <th>Contract</th>
            <th>Type</th>
            <th>Date</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="plannerTable"></tbody>
      </table>
    </div>
  </div>

  <div id="modalOverlay" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-slate-900/50 px-4" aria-hidden="true">
    <div class="w-full max-w-lg rounded-2xl border border-slate-200 bg-white p-6 shadow-xl">
      <div class="flex items-start justify-between gap-4">
        <div>
          <h3 id="modalTitle" class="text-lg font-semibold text-slate-900">Confirm action</h3>
          <p id="modalMessage" class="mt-2 text-sm text-slate-600"></p>
        </div>
        <button id="modalClose" class="text-xl text-slate-400 hover:text-slate-600" aria-label="Close dialog">×</button>
      </div>
      <div class="mt-6 flex flex-wrap justify-end gap-3">
        <button id="modalCancel" class="rounded-lg border border-slate-200 px-4 py-2 text-sm font-medium text-slate-600 hover:bg-slate-50">Cancel</button>
        <button id="modalConfirm" class="rounded-lg bg-indigo-600 px-4 py-2 text-sm font-semibold text-white hover:bg-indigo-500">Confirm</button>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
