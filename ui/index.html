<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ContractOCR UI</title>
  <script>
    tailwind = window.tailwind || {};
    tailwind.config = { corePlugins: { preflight: false } };
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f1f5f9; color: #0f172a; }
    body.theme-dark { background: #0f172a; color: #e2e8f0; }
    .row { display: flex; gap: 16px; }
    .row.wrap { flex-wrap: wrap; }
    .col { flex: 1; }
    .card { border: 1px solid #dbe2f0; border-radius: 10px; padding: 12px; background: #fff; box-shadow: 0 2px 10px rgba(15, 23, 42, 0.06); }
    .drop { border: 2px dashed #94a3b8; border-radius: 10px; padding: 18px; text-align: center; cursor: pointer; background: #f8fafc; }
    .drop.drag { background: #f3f6ff; }
    table { width: 100%; border-collapse: collapse; }
    th, td { border-bottom: 1px solid #eee; padding: 8px; text-align: left; }
    .badge { padding: 3px 8px; border-radius: 999px; color: #fff; font-size: 12px; display: inline-block; }
    .green { background: #2e7d32; }
    .red { background: #c62828; }
    .yellow { background: #b26a00; }
    .muted { color: #666; font-size: 12px; }
    input, button, select { padding: 8px; }
    input, select { border: 1px solid #111; border-radius: 6px; background: #fff; }
    input:focus, select:focus { outline: 2px solid #111; outline-offset: 1px; }
    button { cursor: pointer; background: #0b3a6f; color: #fff; border: 1px solid #0b3a6f; border-radius: 6px; font-weight: 600; }
    button:hover { background: #f28c28; border-color: #f28c28; color: #fff; }
    button:focus { outline: 2px solid #ffffff; outline-offset: 1px; box-shadow: 0 0 0 3px rgba(11, 58, 111, 0.35); }
    a { text-decoration: underline; color: #1d4ed8; font-weight: 600; }
    .small { font-size: 12px; }
    pre { white-space: pre-wrap; word-break: break-word; }
    .hidden { display: none; }
    .nav { display: flex; gap: 10px; margin: 12px 0; }
    .nav button { border: 1px solid #0b3a6f; background: #ffffff; color: #0b3a6f; padding: 10px 14px; border-radius: 6px; font-weight: bold; }
    .nav button:hover { background: #f28c28; border-color: #f28c28; color: #ffffff; }
    .nav button.active { background: #0b3a6f; border-color: #0b3a6f; color: #ffffff; }
    .folder-list { display: flex; flex-direction: column; gap: 12px; margin-top: 10px; }
    .folder-card { border: 1px solid #dce1ff; border-radius: 10px; background: linear-gradient(135deg, #f8f9ff, #ffffff); box-shadow: 0 1px 4px rgba(0,0,0,0.06); }
    .folder-header { display: flex; justify-content: space-between; align-items: center; padding: 12px 14px; border-bottom: 1px solid #e6e9ff; }
    .folder-title { font-weight: bold; font-size: 16px; }
    .folder-body { padding: 10px 14px 12px 14px; border-left: 4px solid #c4cdfc; }
    .event-row { display: flex; gap: 12px; padding: 8px 6px; border-bottom: 1px dashed #e6e9ff; align-items: center; }
    .event-row:last-child { border-bottom: none; }
    .event-date { min-width: 110px; font-weight: bold; color: #2e3b8b; }
    .pill { background: #eef2ff; color: #2e3b8b; padding: 4px 8px; border-radius: 999px; font-size: 11px; border: 1px solid #d0d7ff; }
    .event-type { background: #e3f2fd; color: #1565c0; border-color: #bbdefb; }
    .status-smart { background: #dcfce7; color: #166534; border-color: #86efac; }
    .status-manual { background: #fef3c7; color: #92400e; border-color: #fcd34d; font-weight: 700; }
    .status-inconclusive { background: #fee2e2; color: #991b1b; border-color: #fecaca; }
    .event-renewal { background: #ede9fe; color: #5b21b6; border-color: #c4b5fd; }
    .event-termination { background: #ffe4e6; color: #9f1239; border-color: #fecdd3; }
    .event-effective { background: #e0f2fe; color: #075985; border-color: #bae6fd; }
    .event-auto_opt_out { background: #fef3c7; color: #92400e; border-color: #fcd34d; }
    .legend { border: 1px solid #e5e7eb; border-radius: 8px; padding: 10px; background: #f8fafc; margin-top: 10px; }
    .legend-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 8px; margin-top: 8px; }
    .legend-item { display: flex; align-items: center; gap: 8px; font-size: 12px; color: #374151; }
    .filters label { display: flex; flex-direction: column; gap: 4px; font-size: 12px; color: #444; }
    .section { border: 1px solid #e5e7eb; border-radius: 8px; padding: 10px; margin-top: 10px; background: #f8fafc; }
    details.section { padding: 8px 10px; }
    details.section > summary { cursor: pointer; list-style: none; display: flex; align-items: center; gap: 10px; }
    details.section > summary::-webkit-details-marker { display: none; }
    details.section > summary::marker { content: ""; }
    details.legend > summary { cursor: pointer; list-style: none; display: flex; align-items: center; gap: 10px; }
    details.legend > summary::-webkit-details-marker { display: none; }
    details.legend > summary::marker { content: ""; }
    .summary-chevron { font-size: 25px; color: #64748b; transition: transform 0.2s ease; }
    details.section[open] > summary .summary-chevron,
    details.legend[open] > summary .summary-chevron { transform: rotate(90deg); }
    .summary-title { display: flex; align-items: center; gap: 6px; flex-wrap: wrap; font-weight: bold; font-size: 13px; }
    .summary-meta { display: inline-flex; align-items: center; gap: 8px; font-size: 13px; color: #6b7280; font-weight: normal; margin-left: auto; }
    .pill.tag { border-color: transparent; }
    .section h4 { margin: 0 0 6px 0; }
    .inline { display: inline-flex; gap: 8px; align-items: center; flex-wrap: wrap; }
    .muted-input { width: 100%; box-sizing: border-box; }
    .chip-btn { background: none; border: none; cursor: pointer; color: #b91c1c; margin-left: 6px; }
    .link-button { background: none; border: none; color: #1d4ed8; cursor: pointer; font-weight: 600; padding: 0; }
    .link-button:hover { text-decoration: underline; }
    .profit-center-summary { display: flex; flex-direction: column; gap: 6px; }
    .profit-center-line { display: flex; gap: 8px; flex-wrap: wrap; align-items: baseline; font-size: 12px; }
    .profit-center-group { font-weight: 700; color: #0f172a; min-width: 120px; }
    .profit-center-items { color: #334155; }
    .info-icon { display: inline-flex; align-items: center; justify-content: center; width: 16px; height: 16px; border-radius: 999px; border: 1px solid #94a3b8; color: #475569; font-size: 11px; line-height: 1; cursor: help; }
    .label-with-info { display: inline-flex; align-items: center; gap: 6px; }
    .preview-grid { display: grid; gap: 12px; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); }
    .preview-pane { height: 630px; min-height: 630px; resize: vertical; overflow: auto; }
    .preview-frame { width: 100%; height: 100%; border: 1px solid #e5e7eb; border-radius: 8px; background: #fff; }
    .contract-text { height: 630px; min-height: 630px; resize: vertical; overflow: auto; background: #fff; border: 1px solid #e5e7eb; border-radius: 8px; padding: 10px; font-size: 12px; }
    .preview-fullscreen { overflow: hidden; }
    .preview-fullscreen .contracts-layout { grid-template-columns: minmax(0, 1fr); }
    .preview-fullscreen .contracts-right { display: none; }
    .preview-fullscreen #detail > :not(#contractContent) { display: none; }
    .preview-fullscreen #contractContent { position: fixed; inset: 20px; margin: 0; z-index: 1000; background: #f8fafc; box-shadow: 0 12px 32px rgba(15, 23, 42, 0.2); overflow: auto; }
    .preview-fullscreen #contractContent .preview-grid { grid-template-columns: repeat(auto-fit, minmax(360px, 1fr)); }
    .preview-fullscreen .preview-pane,
    .preview-fullscreen .contract-text { height: calc(100vh - 220px); min-height: 0; }
    .preview-mode-toggle.active { text-decoration: underline; }
    .preview-mode-pdf .preview-panel-ocr,
    .preview-mode-ocr .preview-panel-pdf { display: none; }
    .preview-mode-pdf .preview-grid,
    .preview-mode-ocr .preview-grid { grid-template-columns: minmax(0, 1fr); }
    .expired-bell { display: inline-flex; align-items: center; gap: 4px; padding: 2px 6px; border-radius: 999px; background: #fee2e2; color: #b91c1c; font-size: 10px; font-weight: 700; }
    .planner-calendar { display: grid; grid-template-columns: repeat(7, minmax(0, 1fr)); gap: 1px; margin-top: 12px; border: 1px solid #e5e7eb; border-radius: 8px; overflow: visible; background: #e5e7eb; }
    .planner-cell { background: #ffffff; min-height: 110px; padding: 6px; display: flex; flex-direction: column; gap: 4px; }
    .planner-header { background: #f1f5f9; font-weight: 700; font-size: 12px; text-align: center; padding: 8px 6px; min-height: auto; }
    .planner-day { font-weight: 700; font-size: 12px; color: #1f2937; display: flex; justify-content: space-between; align-items: center; }
    .planner-day.muted { color: #9ca3af; font-weight: 600; }
    .planner-entry { display: flex; flex-direction: column; gap: 2px; padding: 4px 6px; border-radius: 6px; border: 1px solid #e2e8f0; background: #f8fafc; font-size: 11px; color: #1f2937; cursor: pointer; position: relative; }
    .planner-entry:focus { outline: 2px solid #1d4ed8; outline-offset: 2px; }
    .planner-entry:hover { box-shadow: 0 2px 6px rgba(15, 23, 42, 0.15); z-index: 2; }
    .planner-entry.event-renewal { background: #ede9fe; color: #5b21b6; border-color: #c4b5fd; }
    .planner-entry.event-termination { background: #ffe4e6; color: #9f1239; border-color: #fecdd3; }
    .planner-entry.event-effective { background: #e0f2fe; color: #075985; border-color: #bae6fd; }
    .planner-entry.event-auto_opt_out { background: #fef3c7; color: #92400e; border-color: #fcd34d; }
    .planner-entry[data-tooltip]::after { content: attr(data-tooltip); position: absolute; left: 0; top: 100%; margin-top: 6px; background: #111827; color: #f9fafb; padding: 6px 8px; border-radius: 6px; font-size: 11px; line-height: 1.4; white-space: pre-line; width: max-content; max-width: 240px; z-index: 20; opacity: 0; transform: translateY(4px); pointer-events: none; box-shadow: 0 6px 12px rgba(15, 23, 42, 0.2); }
    .planner-entry:hover::after,
    .planner-entry:focus::after { opacity: 1; transform: translateY(0); }
    .planner-entry .entry-title { font-weight: 600; }
    .planner-entry .entry-meta { font-size: 10px; color: #475569; }
    .planner-more { font-size: 10px; color: #2563eb; }
    .planner-empty { min-height: 20px; }
    .planner-panel { border: 1px solid #e5e7eb; border-radius: 10px; padding: 10px; margin-top: 10px; background: #f8fafc; }
    .planner-panel > summary { cursor: pointer; list-style: none; display: flex; align-items: center; justify-content: space-between; gap: 10px; }
    .planner-panel > summary::-webkit-details-marker { display: none; }
    .planner-panel > summary::marker { content: ""; }
    .planner-panel .panel-title { display: flex; align-items: baseline; gap: 8px; font-weight: 700; }
    .planner-panel .panel-title h4 { margin: 0; }
    .planner-panel .panel-meta { font-size: 12px; color: #6b7280; font-weight: 500; }
    .planner-panel .panel-chevron { font-size: 18px; color: #64748b; transition: transform 0.2s ease; }
    .planner-panel[open] .panel-chevron { transform: rotate(180deg); }
    .active-row { background: #fef9c3; }
    .manual-term > summary { background: #fffbeb; border: 1px solid #fde68a; border-radius: 6px; padding: 6px; }
    .event-date-group { background: #f8fafc; }
    .event-date-body { margin-top: 8px; display: flex; flex-direction: column; gap: 8px; }
    .tour-overlay { position: fixed; inset: 0; background: rgba(15, 23, 42, 0.45); z-index: 2000; }
    .tour-tooltip { position: absolute; max-width: 340px; background: #ffffff; color: #0f172a; border-radius: 12px; border: 1px solid #e2e8f0; padding: 14px; box-shadow: 0 12px 28px rgba(15, 23, 42, 0.2); font-size: 13px; }
    .tour-step-label { font-size: 11px; text-transform: uppercase; letter-spacing: 0.08em; color: #64748b; font-weight: 700; }
    .tour-title { font-weight: 700; margin-top: 6px; }
    .tour-body { margin-top: 6px; color: #334155; line-height: 1.4; }
    .tour-actions { display: flex; justify-content: space-between; gap: 8px; margin-top: 12px; }
    .tour-actions button { flex: 1; }
    .tour-highlight { position: relative; z-index: 2101; outline: 3px solid #f28c28; outline-offset: 4px; border-radius: 8px; box-shadow: 0 0 0 4px rgba(242, 140, 40, 0.2); }
    .event-contract-body { margin-top: 6px; border-left: 3px solid #c7d2fe; padding-left: 10px; }
    .danger { background: #dc2626; border-color: #dc2626; }
    .danger:hover { background: #b91c1c; border-color: #b91c1c; }
    .month-nav { display: inline-flex; gap: 6px; align-items: center; }
    .month-nav button { padding: 6px 8px; }
    .contracts-layout { display: grid; grid-template-columns: minmax(0, 2fr) minmax(0, 1fr); gap: 16px; align-items: start; }
    .contracts-right { display: flex; flex-direction: column; gap: 16px; }
    .compact-table th, .compact-table td { padding: 6px; font-size: 12px; }
    .compact-table th { white-space: nowrap; }
    .queue-header { display: flex; align-items: center; justify-content: space-between; gap: 10px; flex-wrap: wrap; }
    .queue-controls { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
    .queue-controls input { min-width: 180px; }
    .queue-scroll { max-height: 360px; overflow: auto; border: 1px solid #e5e7eb; border-radius: 8px; background: #fff; }
    .queue-scroll table { margin: 0; }
    .queue-card { position: relative; }
    .queue-expanded { position: fixed; inset: 20px; z-index: 1000; background: #f8fafc; overflow: auto; }
    .queue-expanded .queue-scroll { max-height: calc(100vh - 260px); }
    .queue-fullscreen { overflow: hidden; }
    .top-bar { display: flex; align-items: center; justify-content: space-between; gap: 12px; flex-wrap: wrap; }
    .theme-toggle { display: inline-flex; align-items: center; gap: 8px; }
    .auth-bar { display: inline-flex; align-items: center; gap: 8px; }
    .theme-toggle button { background: #ffffff; color: #0b3a6f; border-color: #0b3a6f; }
    .theme-toggle button:hover { background: #f28c28; border-color: #f28c28; color: #ffffff; }
    body.theme-dark .card { background: #111827; border-color: #1f2937; box-shadow: 0 2px 10px rgba(15, 23, 42, 0.35); }
    body.theme-dark .drop { background: #0b1220; border-color: #475569; }
    body.theme-dark .nav button { background: #0f172a; color: #e2e8f0; border-color: #60a5fa; }
    body.theme-dark .nav button.active { background: #2563eb; border-color: #2563eb; color: #ffffff; }
    body.theme-dark input, body.theme-dark select { background: #0f172a; color: #e2e8f0; border-color: #475569; }
    body.theme-dark table th, body.theme-dark table td { border-bottom: 1px solid #1f2937; }
    body.theme-dark a { color: #93c5fd; }
    body.theme-dark .muted { color: #94a3b8; }
    body.theme-dark .section { background: #0b1220; border-color: #1f2937; }
    body.theme-dark .legend { background: #0b1220; border-color: #1f2937; }
    body.theme-dark .section ul { color: #cbd5f5; }
    body.theme-dark .profit-center-group { color: #e2e8f0; }
    body.theme-dark .profit-center-items { color: #94a3b8; }
    body.theme-dark .planner-cell { background: #0f172a; }
    body.theme-dark .planner-header { background: #1e293b; }
    body.theme-dark .planner-entry { background: #111827; border-color: #1f2937; color: #e2e8f0; }
    body.theme-dark .contract-text { background: #0f172a; border-color: #1f2937; color: #e2e8f0; }
    body.theme-dark .preview-frame { background: #0f172a; border-color: #1f2937; }
    body.theme-dark.preview-fullscreen #contractContent { background: #0b1220; }
    body.theme-dark .queue-scroll { background: #0f172a; border-color: #1f2937; }
    body.theme-dark .queue-expanded { background: #0b1220; }
    body.theme-dark .event-date { color: #bfdbfe; }
    body.theme-dark #modalOverlay .bg-white { background: #0f172a; border-color: #1f2937; }
    body.theme-dark #modalOverlay .text-slate-900 { color: #e2e8f0; }
    body.theme-dark #modalOverlay .text-slate-600 { color: #94a3b8; }
    body.theme-dark #modalOverlay .text-slate-400 { color: #cbd5f5; }
    body.theme-dark #modalOverlay .border-slate-200 { border-color: #1f2937; }
    body.theme-dark #modalOverlay .hover\:bg-slate-50:hover { background: #1e293b; }
    body.theme-dark #authOverlay .bg-white { background: #0f172a; border-color: #1f2937; }
    body.theme-dark #authOverlay .text-slate-900 { color: #e2e8f0; }
    body.theme-dark #authOverlay .text-slate-600 { color: #94a3b8; }
    body.theme-dark #authOverlay .text-slate-400 { color: #cbd5f5; }
    body.theme-dark #authOverlay .border-slate-200 { border-color: #1f2937; }
    .multi-select { width: 100%; min-height: 180px; max-height: 240px; }
    .multi-select option { padding: 4px; }
    .toast-container { position: fixed; left: 20px; bottom: 20px; z-index: 3000; display: flex; flex-direction: column; gap: 10px; }
    .toast { background: #0f172a; color: #f8fafc; border-radius: 10px; padding: 12px 14px; min-width: 240px; max-width: 360px; box-shadow: 0 8px 20px rgba(15, 23, 42, 0.2); display: flex; align-items: center; justify-content: space-between; gap: 12px; }
    .toast.success { background: #166534; }
    .toast.error { background: #b91c1c; }
    .toast.warning { background: #b45309; }
    .toast .toast-close { background: transparent; border: none; color: inherit; font-size: 16px; cursor: pointer; padding: 0; }
    .toast-hide { opacity: 0; transform: translateY(8px); transition: opacity 0.2s ease, transform 0.2s ease; }
  </style>
</head>
<body>
  <div class="top-bar">
    <h2>ContractOCR</h2>
    <div class="inline" style="gap:16px;">
      <div class="auth-bar">
        <span class="small muted" id="authStatus">Not signed in</span>
        <button id="authLoginButton" type="button">Sign in</button>
        <button id="authLogoutButton" type="button" class="hidden">Sign out</button>
      </div>
      <div class="theme-toggle">
        <span class="small muted" id="themeLabel">Theme: Light</span>
        <button id="themeToggle" type="button">Switch to Dark Theme</button>
      </div>
    </div>
  </div>

  <div class="nav">
    <button id="navContracts" class="active">Contracts</button>
    <button id="navAllContracts">All Contracts</button>
    <button id="navPlanner">Planner</button>
    <button id="navPendingAgreements">Pending Agreements</button>
    <button id="navTasks">Tasks</button>
    <button id="navNotifications">Notifications</button>
    <button id="navAdmin">Admin</button>
    <button id="navOutputs">Support Page</button>
  </div>

  <div id="contractsPage">
    <div class="contracts-layout" style="margin-top:16px">
      <div class="card">
        <h3 style="margin-top:0">Contract Detail</h3>
        <div id="detail" class="muted">Click a contract to view terms/events.</div>
      </div>

      <div class="contracts-right">
        <div class="card">
          <h3 style="margin-top:0">Upload</h3>
          <div id="drop" class="drop">Drag & drop PDF(s) here, or click to choose</div>
          <input id="filePicker" type="file" multiple accept=".pdf,.png,.jpg,.jpeg,.tif,.tiff" style="display:none" />
          <div id="uploadLog" class="small muted" style="margin-top:10px"></div>
        </div>
        <div class="card">
          <div style="display:flex; justify-content:space-between; align-items:center;">
            <h3 style="margin:0">Recent Contracts</h3>
            <button id="refresh">Refresh</button>
          </div>
          <div class="muted small" style="margin-top:6px">Showing 5 most recent processed contracts.</div>
          <details class="legend">
            <summary class="small"><span class="summary-chevron" aria-hidden="true">▸</span><span class="summary-title">Color key</span></summary>
            <div class="legend-grid">
              <div class="legend-item"><span class="badge green">processed</span> Completed processing</div>
              <div class="legend-item"><span class="badge yellow">processing</span> OCR in progress</div>
              <div class="legend-item"><span class="badge red">error</span> Processing error</div>
              <div class="legend-item"><span class="pill status-smart">smart</span> High-confidence extraction</div>
              <div class="legend-item"><span class="pill status-manual">manual</span> Manually entered</div>
              <div class="legend-item"><span class="pill status-inconclusive">inconclusive</span> Low confidence</div>
              <div class="legend-item"><span class="pill event-type event-effective">effective</span> Key date</div>
              <div class="legend-item"><span class="pill event-type event-renewal">renewal</span> Renewal timeline</div>
              <div class="legend-item"><span class="pill event-type event-termination">termination</span> Termination date</div>
              <div class="legend-item"><span class="pill event-type event-auto_opt_out">auto opt-out</span> Notice deadline</div>
            </div>
            <div class="muted small" style="margin-top:6px;">Tag colors come from the tag settings.</div>
          </details>
          <table class="compact-table" style="margin-top:10px">
            <thead>
              <tr>
                <th>Status</th>
                <th>Title</th>
                <th>Uploaded</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="contracts"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <div id="allContractsPage" class="hidden">
    <div class="card" style="margin-top:16px">
      <div style="display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;">
        <div>
          <h3 style="margin:0">All Contracts</h3>
          <div class="muted small">Search across titles, vendors, filenames, and OCR text.</div>
        </div>
        <div class="inline">
          <button id="allRefresh">Refresh</button>
          <button id="allContractsExport">Export CSV</button>
        </div>
      </div>

      <div class="row wrap filters" style="margin-top:12px; gap:12px;">
        <label style="flex:1; min-width:240px;">
          Search
          <input id="allContractsSearch" type="text" placeholder="Search contracts..." />
        </label>
        <label style="min-width:160px;">
          Status
          <select id="allContractsStatus"></select>
        </label>
        <label style="min-width:200px;">
          Contract Type
          <select id="allContractsType"></select>
        </label>
      </div>
      <div class="muted small" id="allContractsStatus" style="margin-top:4px"></div>
      <table style="margin-top:10px">
        <thead>
          <tr>
            <th>Status</th>
            <th>Title</th>
            <th>Vendor</th>
            <th>Contract Type</th>
            <th>Profit Centers</th>
            <th>Uploaded</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="allContractsTable"></tbody>
      </table>
      <div style="margin-top:10px;">
        <button id="allContractsLoadMore">Load more</button>
      </div>
    </div>
  </div>

  <div id="plannerPage" class="hidden">
    <div class="card" style="margin-top:16px">
      <div style="display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;">
        <div>
          <h3 style="margin:0">Event Planner</h3>
          <div class="muted small">Add or edit renewal timelines and events for any contract.</div>
        </div>
        <div class="inline">
          <button id="plannerRefresh">Refresh</button>
          <button id="plannerExport">Export CSV</button>
        </div>
      </div>

      <div class="row wrap filters" style="margin-top:12px; gap:12px;">
        <label style="min-width:220px;">
          <span class="label-with-info">
            <span class="info-icon" title="Choose a month to populate the planner grid.">i</span>
            <span>Show Month</span>
          </span>
          <div class="month-nav">
            <button type="button" id="plannerPrevMonth">◀</button>
            <input type="month" id="plannerMonth" />
            <button type="button" id="plannerNextMonth">▶</button>
          </div>
        </label>
        <label style="min-width:170px; align-items:center; flex-direction:row; gap:8px; margin-top:18px;">
          <input type="checkbox" id="plannerAllMonths" />
          Show all months
        </label>
      </div>

      <div class="row wrap filters" style="margin-top:8px; gap:12px;">
        <label style="min-width:200px;">
          <span class="label-with-info">
            <span class="info-icon" title="Pick the contract to attach the new event to.">i</span>
            <span>Contract</span>
          </span>
          <select id="plannerContract"></select>
        </label>
        <label style="min-width:140px;">
          <span class="label-with-info">
            <span class="info-icon" title="Select the event type for the new planner entry.">i</span>
            <span>Event Type</span>
          </span>
          <select id="plannerEventType">
            <option value="renewal">Renewal</option>
            <option value="termination">Termination</option>
            <option value="effective">Effective</option>
            <option value="auto_opt_out">Auto opt-out</option>
            <option value="custom">Custom</option>
          </select>
        </label>
        <label style="min-width:160px;">
          <span class="label-with-info">
            <span class="info-icon" title="Select the date you want this event to appear on.">i</span>
            <span>Event Date</span>
          </span>
          <input type="date" id="plannerEventDate" />
        </label>
        <label style="flex:1; min-width:200px;">
          <span class="label-with-info">
            <span class="info-icon" title="Provide a custom label when Event Type is set to Custom.">i</span>
            <span>Custom Type (if chosen)</span>
          </span>
          <input type="text" id="plannerCustomType" placeholder="e.g., Notice" />
        </label>
        <button id="plannerAdd">Add Event</button>
      </div>

      <div class="muted small" id="plannerStatus" style="margin-top:4px"></div>
      <details class="planner-panel" open>
        <summary>
          <div class="panel-title">
            <h4>Calendar View</h4>
            <span class="panel-meta">Monthly event grid</span>
          </div>
          <span class="panel-chevron" aria-hidden="true">▾</span>
        </summary>
        <div class="muted small" style="margin-top:6px;">Shows events on the selected month. Abbreviated contract names appear on each day.</div>
        <div id="plannerCalendar" class="planner-calendar"></div>
        <table style="width:100%; margin-top:10px; border-collapse:collapse;">
          <thead>
            <tr>
              <th>Contract</th>
              <th>Type</th>
              <th>Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="plannerTable"></tbody>
        </table>
      </details>
      <details class="planner-panel" style="margin-top:16px;">
        <summary>
          <div class="panel-title">
            <h4>List View</h4>
            <span class="panel-meta">Search and review timelines</span>
          </div>
          <span class="panel-chevron" aria-hidden="true">▾</span>
        </summary>
        <div style="display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap; margin-top:10px;">
          <div>
            <div class="muted small">Search and review renewal/termination timelines by date and contract.</div>
          </div>
          <div class="inline">
            <button id="eventsRefresh">Refresh</button>
            <button id="eventsExport">Export CSV</button>
          </div>
        </div>

        <div class="row wrap filters" style="margin-top:12px; gap:12px;">
          <label style="min-width:220px;">
            <span class="label-with-info">
              <span class="info-icon" title="Select a month to focus the event list. Use the arrows to move month by month.">i</span>
              <span>Show Month</span>
            </span>
            <div class="month-nav">
              <button type="button" id="eventPrevMonth">◀</button>
              <input id="eventMonth" type="month" />
              <button type="button" id="eventNextMonth">▶</button>
            </div>
          </label>
          <label style="min-width:140px; align-items:center; flex-direction:row; gap:8px; margin-top:18px;">
            <input type="checkbox" id="eventAllMonths" />
            Show all months
          </label>
          <label style="min-width:160px;">
            <span class="label-with-info">
              <span class="info-icon" title="Event types come from extracted terms and manual entries. Renewal/termination dates appear when the contract has a term length or specific date captured. Auto-renewing contracts without a term length may not show future renewals.">i</span>
              <span>Event Type</span>
            </span>
            <select id="eventTypeFilter">
              <option value="all">All types</option>
              <option value="renewal">Renewal</option>
              <option value="termination">Termination</option>
              <option value="auto_opt_out">Auto opt-out</option>
              <option value="effective">Effective</option>
            </select>
          </label>
          <label style="min-width:160px;">
            <span class="label-with-info">
              <span class="info-icon" title="Sort events by date or contract title.">i</span>
              <span>Sort</span>
            </span>
            <select id="eventSort">
              <option value="date_asc">Date ↑</option>
              <option value="date_desc">Date ↓</option>
              <option value="title_asc">Title A→Z</option>
              <option value="title_desc">Title Z→A</option>
            </select>
          </label>
          <label style="flex:1; min-width:200px;">
            <span class="label-with-info">
              <span class="info-icon" title="Search by contract title, vendor, or event type.">i</span>
              <span>Search contracts or event types</span>
            </span>
            <input id="eventSearch" type="text" placeholder="Search by contract, vendor, or event…" />
          </label>
          <label style="min-width:170px; align-items:center; flex-direction:row; gap:8px; margin-top:18px;">
            <input type="checkbox" id="expiringOnly" />
            <span class="label-with-info">
              <span class="info-icon" title="Filters to renewal, termination, and auto opt-out deadlines so evergreen contracts stay out of the list unless they have a defined notice or end date.">i</span>
              <span>Expiring-only</span>
            </span>
          </label>
        </div>

        <div class="muted small" id="eventsStatus" style="margin-top:4px"></div>
        <div id="eventsList" class="folder-list"></div>
      </details>
    </div>
  </div>

  <div id="pendingAgreementsPage" class="hidden">
    <div class="card" style="margin-top:16px">
      <div style="display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;">
        <div>
          <h3 style="margin:0">Pending Agreements</h3>
          <div class="muted small">Admin setup for recurring reminders, notification recipients, and approval nudges.</div>
        </div>
        <button id="pendingAgreementsGuide" type="button">Guided walkthrough</button>
      </div>

      <div class="section" style="margin-top:12px;">
        <h4>Admin setup overview</h4>
        <ul class="small" style="margin:6px 0 0 18px; color:#374151;">
          <li>Set reminder cadence (daily, weekly, monthly) and choose roles or individuals for approvals.</li>
          <li>Configure event-driven notifications for renewals, opt-outs, and effective dates.</li>
          <li>Send one-time nudges for urgent approvals or reviews.</li>
          <li>Create recurring alerts relative to due dates (7 days before, 1 day before, due date, and after).</li>
        </ul>
      </div>

      <div class="row wrap" style="margin-top:12px;">
        <div class="col card">
          <h4 style="margin-top:0;">Pending Agreement Reminders</h4>
          <div class="muted small">Save reminder rules for pending approvals and select recipients.</div>
          <div class="section" style="margin-top:10px;">
            <label class="small" style="display:block; margin-bottom:8px;">
              <span>Frequency</span>
              <select id="pendingReminderFrequency" class="muted-input">
                <option value="daily">Daily</option>
                <option value="weekly" selected>Weekly</option>
                <option value="monthly">Monthly</option>
              </select>
            </label>
            <div class="small" style="margin-bottom:8px;">
              <div class="label-with-info">
                <span>Recipient roles</span>
                <span class="info-icon" title="Assign reminders to specific roles in addition to individuals.">i</span>
              </div>
              <div id="pendingRoleOptions" class="row wrap" style="margin-top:6px;"></div>
            </div>
            <div class="small" style="margin-bottom:8px;">
              <div class="label-with-info">
                <span>Individual recipients</span>
                <span class="info-icon" title="Select named users to receive approval reminders.">i</span>
              </div>
              <div id="pendingRecipientOptions" class="row wrap" style="margin-top:6px;"></div>
            </div>
            <label class="small" style="display:block; margin-bottom:8px;">
              <span>Reminder message</span>
              <input id="pendingReminderMessage" class="muted-input" placeholder="Approve pending agreements for this week." />
            </label>
            <button id="pendingReminderSave">Save Reminder Rule</button>
            <div class="muted small" id="pendingReminderStatus" style="margin-top:6px;"></div>
          </div>
          <table class="compact-table" style="margin-top:10px;">
            <thead>
              <tr>
                <th>Frequency</th>
                <th>Roles</th>
                <th>Recipients</th>
                <th>Message</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="pendingReminderTable"></tbody>
          </table>
        </div>
        <div class="col card" style="display:flex; flex-direction:column; gap:12px;">
          <div class="section">
            <h4 style="margin-top:0;">Notification recipients</h4>
            <div class="muted small">Manage the user list used across reminders and task assignments.</div>
            <div id="pendingUserDirectory" class="folder-list"></div>
            <div class="inline" style="margin-top:8px;">
              <input id="pendingUserName" placeholder="Name" />
              <input id="pendingUserEmail" placeholder="Email" />
              <button id="pendingUserAdd" type="button">Add user</button>
            </div>
            <div class="muted small" id="pendingUserStatus" style="margin-top:6px;"></div>
          </div>
          <div class="section small muted">
            Pending agreements are approval workflows tied to contracts; tasks are manual to-dos you assign to a person.
          </div>
        </div>
        <div class="col card queue-card" id="pendingAgreementsQueueCard">
          <div class="queue-header">
            <div>
              <h4 style="margin-top:0;">Pending Agreements Queue</h4>
              <div class="muted small">Track approvals that need action and send quick nudges.</div>
            </div>
            <div class="queue-controls">
              <input id="pendingAgreementsSearch" placeholder="Search queue" />
              <button id="pendingAgreementsSearchButton" type="button">Search</button>
              <button id="pendingAgreementsSearchClear" type="button">Clear</button>
              <button id="pendingAgreementsAdd" type="button">Add agreement</button>
              <button id="pendingAgreementsQueueExpand" type="button" aria-pressed="false">Expand</button>
            </div>
          </div>
          <div class="muted small" id="pendingAgreementsMeta" style="margin-top:6px;"></div>
          <div class="queue-scroll" style="margin-top:10px;">
            <table class="compact-table">
              <thead>
                <tr>
                  <th>Agreement</th>
                  <th>Contract</th>
                  <th>Owner</th>
                  <th>Due</th>
                  <th>Status</th>
                  <th>Created</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody id="pendingAgreementsTable"></tbody>
            </table>
          </div>
          <button id="pendingAgreementsLoadMore" class="hidden" type="button" style="margin-top:10px;">
            Load more
          </button>
        </div>
      </div>
    </div>
  </div>

  <div id="tasksPage" class="hidden">
    <div class="card" style="margin-top:16px">
      <div style="display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;">
        <div>
          <h3 style="margin:0">Tasks</h3>
          <div class="muted small">Create task assignments, configure reminders, and send nudges.</div>
        </div>
        <button id="tasksGuide" type="button">Guided walkthrough</button>
      </div>

      <div class="row wrap" style="margin-top:12px;">
        <div class="col card">
          <h4 style="margin-top:0;">Create Task</h4>
          <div class="section" style="margin-top:10px;">
            <label class="small" style="display:block; margin-bottom:8px;">
              <span>Task title</span>
              <input id="taskTitle" class="muted-input" placeholder="Review renewal clause for ACME" />
            </label>
            <label class="small" style="display:block; margin-bottom:8px;">
              <span>Description</span>
              <input id="taskDescription" class="muted-input" placeholder="Confirm renewal timeline and opt-out notice." />
            </label>
            <label class="small" style="display:block; margin-bottom:8px;">
              <span>Due date</span>
              <input type="date" id="taskDueDate" class="muted-input" />
            </label>
            <label class="small" style="display:block; margin-bottom:8px;">
              <span>Recurrence</span>
              <select id="taskRecurrence" class="muted-input">
                <option value="none" selected>None</option>
                <option value="weekly">Weekly</option>
                <option value="monthly">Monthly</option>
              </select>
            </label>
            <div class="small" style="margin-bottom:8px;">
              <div class="label-with-info">
                <span>Reminder offsets</span>
                <span class="info-icon" title="Offsets are relative to the due date.">i</span>
              </div>
              <div id="taskReminderOptions" class="row wrap" style="margin-top:6px;"></div>
            </div>
            <div class="small" style="margin-bottom:8px;">
              <div class="label-with-info">
                <span>Assignees</span>
                <span class="info-icon" title="Choose one or more users to receive nudges.">i</span>
              </div>
              <div id="taskAssigneeOptions" class="row wrap" style="margin-top:6px;"></div>
            </div>
            <button id="taskCreate">Create Task</button>
            <div class="muted small" id="taskStatus" style="margin-top:6px;"></div>
          </div>
        </div>
        <div class="col card queue-card" id="taskQueueCard">
          <div class="queue-header">
            <div>
              <h4 style="margin-top:0;">Task Queue</h4>
              <div class="muted small">Manual nudges send immediate email reminders with direct links.</div>
            </div>
            <div class="queue-controls">
              <input id="taskQueueSearch" placeholder="Search tasks" />
              <button id="taskQueueSearchButton" type="button">Search</button>
              <button id="taskQueueSearchClear" type="button">Clear</button>
              <button id="taskQueueExpand" type="button" aria-pressed="false">Expand</button>
            </div>
          </div>
          <div class="muted small" id="taskQueueMeta" style="margin-top:6px;"></div>
          <div class="queue-scroll" style="margin-top:10px;">
            <table class="compact-table">
              <thead>
                <tr>
                  <th>Task</th>
                  <th>Assignees</th>
                  <th>Due</th>
                  <th>Reminders</th>
                  <th>Created</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="taskTable"></tbody>
            </table>
          </div>
          <button id="taskQueueLoadMore" class="hidden" type="button" style="margin-top:10px;">
            Load more
          </button>
          <div class="section" style="margin-top:12px;">
            <h4>User directory</h4>
            <div class="muted small">Define the shared list of users available for reminder configuration.</div>
            <div id="taskUserDirectory" class="folder-list"></div>
            <div class="inline" style="margin-top:8px;">
              <input id="taskUserName" placeholder="Name" />
              <input id="taskUserEmail" placeholder="Email" />
              <button id="taskUserAdd" type="button">Add user</button>
            </div>
            <div class="muted small" id="taskUserStatus" style="margin-top:6px;"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="notificationsPage" class="hidden">
    <div class="card" style="margin-top:16px">
      <div style="display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;">
        <div>
          <h3 style="margin:0">Notifications</h3>
          <div class="muted small">Review what emails are scheduled, who receives them, and track delivery history.</div>
        </div>
        <button id="notificationsGuide" type="button">Guided walkthrough</button>
      </div>

      <div class="section" style="margin-top:12px;" id="notificationOverview">
        <h4>Email trigger overview</h4>
        <div class="muted small">See active reminders and nudges that will result in email sends.</div>
        <div class="row wrap" style="gap:12px; margin-top:10px;">
          <div class="col card" id="notificationEventRules">
            <h4 style="margin-top:0;">Contract event reminders</h4>
            <div class="muted small">Renewal, termination, and effective date reminders with offsets.</div>
            <table class="compact-table" style="margin-top:10px;">
              <thead>
                <tr>
                  <th>Contract</th>
                  <th>Event</th>
                  <th>Date</th>
                  <th>Offsets</th>
                  <th>Recipients</th>
                </tr>
              </thead>
              <tbody id="notificationEventTable"></tbody>
            </table>
          </div>
          <div class="col card" id="notificationPendingRules">
            <h4 style="margin-top:0;">Pending agreement reminders</h4>
            <div class="muted small">Scheduled nudges for pending approvals.</div>
            <table class="compact-table" style="margin-top:10px;">
              <thead>
                <tr>
                  <th>Frequency</th>
                  <th>Roles</th>
                  <th>Recipients</th>
                  <th>Message</th>
                </tr>
              </thead>
              <tbody id="notificationPendingTable"></tbody>
            </table>
          </div>
        </div>
        <div class="row wrap" style="gap:12px; margin-top:12px;">
          <div class="col card" id="notificationTaskRules">
            <h4 style="margin-top:0;">Task reminders</h4>
            <div class="muted small">Task reminders use offsets relative to due dates.</div>
            <table class="compact-table" style="margin-top:10px;">
              <thead>
                <tr>
                  <th>Task</th>
                  <th>Due</th>
                  <th>Offsets</th>
                  <th>Assignees</th>
                </tr>
              </thead>
              <tbody id="notificationTaskTable"></tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="section" style="margin-top:12px;" id="notificationLogSection">
        <div style="display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;">
          <div>
            <h4 style="margin:0;">Notification delivery log</h4>
            <div class="muted small">Search sent or failed email notifications stored in the database.</div>
          </div>
          <div class="inline">
            <button id="notificationLogRefresh" type="button">Refresh</button>
          </div>
        </div>
        <div class="row wrap filters" style="margin-top:12px; gap:12px;">
          <label style="flex:1; min-width:220px;">
            <span class="label-with-info">
              <span class="info-icon" title="Search by subject line, recipient, status, or related ID.">i</span>
              <span>Search log</span>
            </span>
            <input id="notificationLogSearch" type="text" placeholder="Search subject, recipient, or metadata" />
          </label>
          <label style="min-width:160px;">
            <span class="label-with-info">
              <span class="info-icon" title="Filter by delivery status.">i</span>
              <span>Status</span>
            </span>
            <select id="notificationLogStatus">
              <option value="all">All statuses</option>
              <option value="sent">Sent</option>
              <option value="error">Error</option>
            </select>
          </label>
          <label style="min-width:200px;">
            <span class="label-with-info">
              <span class="info-icon" title="Filter by notification type.">i</span>
              <span>Type</span>
            </span>
            <select id="notificationLogKind">
              <option value="all">All types</option>
              <option value="event_reminder">Event reminder</option>
              <option value="pending_agreement_reminder">Pending agreement reminder</option>
              <option value="pending_agreement_nudge">Pending agreement nudge</option>
              <option value="pending_agreement_action">Pending agreement action</option>
              <option value="task_nudge">Task nudge</option>
            </select>
          </label>
          <div class="inline" style="margin-top:18px;">
            <button id="notificationLogSearchButton" type="button">Search</button>
            <button id="notificationLogSearchClear" type="button">Clear</button>
          </div>
        </div>
        <div class="muted small" id="notificationLogMeta" style="margin-top:6px;"></div>
        <div class="queue-scroll" style="margin-top:10px;">
          <table class="compact-table">
            <thead>
              <tr>
                <th>Sent at</th>
                <th>Type</th>
                <th>Recipients</th>
                <th>Subject</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="notificationLogTable"></tbody>
          </table>
        </div>
        <button id="notificationLogLoadMore" class="hidden" type="button" style="margin-top:10px;">
          Load more
        </button>
      </div>
    </div>
  </div>

  <div id="adminPage" class="hidden">
    <div class="card">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <h3 style="margin:0">Admin Center</h3>
        <button id="adminRefresh">Refresh</button>
      </div>
      <div class="muted small" style="margin-top:6px;">
        Manage users, roles, and tag permissions. Tags without assigned roles remain visible to everyone.
      </div>

      <div class="section">
        <h4>Users</h4>
        <div class="row wrap">
          <label class="col small">Name
            <input id="adminUserName" class="muted-input" placeholder="Full name" />
          </label>
          <label class="col small">Email
            <input id="adminUserEmail" class="muted-input" placeholder="email@company.com" />
          </label>
          <label class="col small">Password
            <input id="adminUserPassword" class="muted-input" type="password" placeholder="Set or reset password" />
          </label>
        </div>
        <div class="row wrap" style="margin-top:8px;">
          <label class="inline small"><input id="adminUserActive" type="checkbox" checked /> Active</label>
          <label class="inline small"><input id="adminUserAdmin" type="checkbox" /> Admin</label>
        </div>
        <div class="small muted" style="margin-top:8px;">Assign roles</div>
        <div id="adminUserRoles" class="row wrap" style="margin-top:6px;"></div>
        <div class="small muted" style="margin-top:12px;">Assign profit centers</div>
        <select id="adminUserProfitCenters" class="multi-select" multiple size="8" style="margin-top:6px;"></select>
        <div class="small muted" style="margin-top:12px;">Assign profit center groups</div>
        <select id="adminUserProfitCenterGroups" class="multi-select" multiple size="6" style="margin-top:6px;"></select>
        <div class="row wrap" style="margin-top:8px;">
          <button id="adminUserSave">Add user</button>
          <button id="adminUserCancel" class="link-button" type="button">Cancel</button>
          <div id="adminUserStatus" class="muted small"></div>
        </div>
        <table class="compact-table" style="margin-top:10px;">
          <thead>
            <tr>
              <th>Name</th>
              <th>Email</th>
              <th>Roles</th>
              <th>Admin</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="adminUsersTable"></tbody>
        </table>
      </div>

      <div class="section">
        <h4>Roles</h4>
        <div class="row wrap">
          <label class="col small">Role name
            <input id="adminRoleName" class="muted-input" placeholder="e.g., Legal" />
          </label>
          <label class="col small">Description
            <input id="adminRoleDescription" class="muted-input" placeholder="Optional description" />
          </label>
        </div>
        <div class="row wrap" style="margin-top:8px;">
          <button id="adminRoleSave">Add role</button>
          <button id="adminRoleCancel" class="link-button" type="button">Cancel</button>
          <div id="adminRoleStatus" class="muted small"></div>
        </div>
        <table class="compact-table" style="margin-top:10px;">
          <thead>
            <tr>
              <th>Role</th>
              <th>Description</th>
              <th></th>
              <th></th>
            </tr>
          </thead>
          <tbody id="adminRolesTable"></tbody>
        </table>
      </div>

      <div class="section">
        <h4>Tag permissions</h4>
        <div class="muted small" style="margin-top:6px;">
          Assign roles to restrict tag visibility. Leave a tag unchecked to keep it open to all users.
        </div>
        <table class="compact-table" style="margin-top:10px;">
          <thead>
            <tr>
              <th>Tag</th>
              <th>Allowed roles</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="adminTagPermissionsTable"></tbody>
        </table>
        <div id="adminTagStatus" class="muted small" style="margin-top:6px;"></div>
      </div>

      <div class="section">
        <h4>Agreement types & keywords</h4>
        <div class="muted small" style="margin-top:6px;">
          Maintain agreement type labels and the keywords used for auto-detection in searches.
        </div>
        <div class="row wrap" style="margin-top:10px;">
          <label class="col small">New agreement type
            <input id="adminAgreementTypeName" class="muted-input" placeholder="e.g., Data Processing Agreement" />
          </label>
          <button id="adminAgreementTypeAdd">Add type</button>
          <div id="adminAgreementTypeStatus" class="muted small"></div>
        </div>
        <table class="compact-table" style="margin-top:10px;">
          <thead>
            <tr>
              <th>Type</th>
              <th>Keywords</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="adminAgreementTypesTable"></tbody>
        </table>
      </div>

      <div class="section">
        <h4>Profit centers</h4>
        <div class="muted small" style="margin-top:6px;">
          Manage profit center numbers used to group department access.
        </div>
        <div class="row wrap" style="margin-top:10px;">
          <label class="col small">Profit center code
            <input id="adminProfitCenterCode" class="muted-input" placeholder="e.g., 1200" />
          </label>
          <label class="col small">Profit center name
            <input id="adminProfitCenterName" class="muted-input" placeholder="e.g., Commercial Sales & Supply" />
          </label>
          <label class="col small">Parent group
            <input id="adminProfitCenterGroup" class="muted-input" placeholder="e.g., Transportation" />
          </label>
        </div>
        <div class="row wrap" style="margin-top:8px;">
          <button id="adminProfitCenterSave">Add profit center</button>
          <button id="adminProfitCenterCancel" class="link-button" type="button">Cancel</button>
          <div id="adminProfitCenterStatus" class="muted small"></div>
        </div>
        <table class="compact-table" style="margin-top:10px;">
          <thead>
            <tr>
              <th>Code</th>
              <th>Name</th>
              <th>Group</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="adminProfitCentersTable"></tbody>
        </table>
      </div>
    </div>
  </div>

  <div id="outputsPage" class="hidden">
    <div class="card" style="margin-top:16px">
      <div style="display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;">
        <div>
          <h3 style="margin:0">Support Page</h3>
          <div class="muted small">How to read confidence scores, labels, and where to get help.</div>
        </div>
      </div>

      <div class="section" style="margin-top:12px;">
        <h4>Color key</h4>
        <div class="legend-grid">
          <div class="legend-item"><span class="badge green">processed</span> Completed processing</div>
          <div class="legend-item"><span class="badge yellow">processing</span> OCR in progress</div>
          <div class="legend-item"><span class="badge red">error</span> Processing error</div>
          <div class="legend-item"><span class="pill status-smart">smart</span> High-confidence extraction</div>
          <div class="legend-item"><span class="pill status-manual">manual</span> Manually entered</div>
          <div class="legend-item"><span class="pill status-inconclusive">inconclusive</span> Low confidence</div>
          <div class="legend-item"><span class="pill event-type event-effective">effective</span> Key date</div>
          <div class="legend-item"><span class="pill event-type event-renewal">renewal</span> Renewal timeline</div>
          <div class="legend-item"><span class="pill event-type event-termination">termination</span> Termination date</div>
          <div class="legend-item"><span class="pill event-type event-auto_opt_out">auto opt-out</span> Notice deadline</div>
        </div>
      </div>

      <div class="section" style="margin-top:12px;">
        <h4>Confidence scores</h4>
        <p class="muted small">
          Each extracted term includes a confidence score between 0.00 and 1.00. A score of 0.75 means the OCR model
          is about 75% confident in the value. It is close, but still needs a quick human review before you rely on it.
        </p>
        <ul class="small" style="margin:8px 0 0 18px; color:#374151;">
          <li><b>0.90+</b> — High confidence. Typically safe to accept with a fast spot check.</li>
          <li><b>0.70–0.89</b> — Medium confidence. Review the source text to confirm.</li>
          <li><b>Below 0.70</b> — Low confidence. Treat as inconclusive and verify or update manually.</li>
        </ul>
      </div>

      <div class="section">
        <h4>Status labels</h4>
        <div class="row wrap" style="gap:8px;">
          <span class="pill status-smart">smart</span>
          <span class="pill status-manual">manual</span>
          <span class="pill status-inconclusive">inconclusive</span>
        </div>
        <p class="muted small" style="margin-top:6px;">
          <b>Smart</b> indicates OCR extraction with higher confidence. <b>Manual</b> means a user entered or confirmed the term.
          <b>Inconclusive</b> flags lower-confidence values that should be reviewed.
        </p>
      </div>

      <div class="section">
        <h4>Adjusting results</h4>
        <p class="muted small">
          Use the Terms panel in Contract Detail to edit values, change the status, or add missing terms. Updating a term to
          <b>manual</b> is the best way to confirm a value after review. If a term is incorrect, edit the value and save it to
          override the OCR output.
        </p>
        <p class="muted small" style="margin-top:6px;">
          You can also add or edit Events to align renewal dates, terminations, or notice deadlines that the OCR may have missed.
        </p>
      </div>

      <div class="section">
        <h4>Reminder scheduling & email setup</h4>
        <p class="muted small">
          Reminders are configured per event from <b>Contract Detail → Events</b>. Use the <b>Emails</b> field to add recipients
          as comma-separated addresses (for example: <code>legal@company.com, ops@company.com</code>). Use the
          <b>Offsets</b> field to define when reminders are sent relative to the event date.
        </p>
        <ul class="small" style="margin:8px 0 0 18px;">
          <li><b>Offsets are in days before the event date.</b> An offset of <b>30</b> means the reminder sends 30 days before the event.</li>
          <li>Use multiple offsets to send multiple reminders (for example: <b>90, 60, 30, 7, 1</b>).</li>
          <li><b>0</b> sends the reminder on the event date itself.</li>
          <li>Only non-negative integers are accepted.</li>
        </ul>
        <p class="muted small" style="margin-top:6px;">
          After saving, the reminder status in the event list will show the configured offsets and recipients.
        </p>
        <p class="muted small" style="margin-top:6px;">
          Event reminder emails include contract details (including the event type and contract status). Set
          <code>APP_BASE_URL</code> (or <code>PUBLIC_APP_URL</code>) so emails include a direct link back to ContractOCR and the
          contract PDF.
        </p>
      </div>
      <div class="section">
        <h4>Weekly contract reminder (7-day lookahead)</h4>
        <ol class="small" style="margin:8px 0 0 18px;">
          <li>Open <b>Contracts</b> and select the contract you want to track.</li>
          <li>In <b>Contract Detail → Events</b>, add or confirm a renewal, termination, or notice event date.</li>
          <li>Enter recipient emails in the <b>Emails</b> field using comma-separated addresses.</li>
          <li>Set the <b>Offsets</b> field to <b>7</b> so the reminder sends one week before the event.</li>
          <li>Save the event reminder and verify the offsets appear in the Events list.</li>
        </ol>
        <p class="muted small" style="margin-top:6px;">
          To send a weekly summary for upcoming contracts, repeat this pattern for the renewal or termination dates that need
          a 7-day heads-up.
        </p>
      </div>
      <div class="section">
        <h4>Pending agreements & tasks quick steps</h4>
        <div class="small" style="color:#374151;">
          <p style="margin:0 0 6px 0;"><b>Pending Agreement Reminders</b></p>
          <ol style="margin:0 0 10px 18px;">
            <li>Add notification recipients in the Pending Agreements page if they are not listed yet.</li>
            <li>Select a frequency, choose roles and/or individual recipients, and enter a reminder message.</li>
            <li>Click <b>Save Reminder Rule</b> and confirm the rule appears in the reminder table.</li>
          </ol>
          <p style="margin:0 0 10px 0;">
            Tip: Notification recipients are stored in the user directory so you can reuse them across reminders without
            retyping emails. Add multiple recipients by selecting more than one user.
          </p>
          <p style="margin:0 0 6px 0;"><b>Pending Agreements Queue</b></p>
          <ol style="margin:0 0 10px 18px;">
            <li>Click <b>Add agreement</b> to create a pending approval entry.</li>
            <li>Fill in the agreement title, owner, due date, and status, then save.</li>
            <li>Use search or the action buttons to nudge, edit, or remove pending approvals.</li>
          </ol>
          <p style="margin:0 0 6px 0;"><b>Tasks Queue</b></p>
          <ol style="margin:0 0 0 18px;">
            <li>Add users to the Task user directory so they can be assigned.</li>
            <li>Enter a task title, description, due date, recurrence, and reminder offsets.</li>
            <li>Select assignees and click <b>Create Task</b> to populate the queue.</li>
          </ol>
        </div>
      </div>
      <div class="section">
        <h4>SMTP placeholders</h4>
        <p class="muted small">
          Replace the placeholders below when configuring SMTP for nudge and reminder emails.
        </p>
        <pre class="small">SMTP_HOST=smtp.sendgrid.net
SMTP_USERNAME=ATLASSMTPUSER
SMTP_PASSWORD=ATLASPASSWORD
APP_BASE_URL=https://contracts.yourcompany.com</pre>
      </div>
      <div class="section">
        <h4>Page guide</h4>
        <p class="muted small">
          Use this quick guide to understand what each area of the app is for and how to navigate it.
        </p>
        <ul class="small" style="margin:8px 0 0 18px;">
          <li><b>Contracts</b> — Review recent uploads, open a contract detail view, edit terms, and manage events.</li>
          <li><b>All Contracts</b> — Search, filter, and export the full contract list across all statuses.</li>
          <li><b>Planner</b> — Add or adjust events on a calendar grid, then review upcoming dates in the list view.</li>
          <li><b>Notifications</b> — Track scheduled emails, reminder recipients, and delivery history.</li>
          <li><b>Admin</b> — Manage users, roles, and tag-based access rules.</li>
          <li><b>Support Page</b> — Reference color meanings, confidence guidance, and workflow tips.</li>
        </ul>
      </div>
      <div class="section">
        <h4>Support</h4>
        <p class="muted small">Questions or issues? Email <a href="mailto:<PLACEHOLDERFOREMAIL>"><PLACEHOLDERFOREMAIL></a>.</p>
      </div>
    </div>
  </div>

  <div id="pendingReminderModal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-slate-900/50 px-4" aria-hidden="true">
    <div class="w-full max-w-xl rounded-2xl border border-slate-200 bg-white p-6 shadow-xl">
      <div class="flex items-start justify-between gap-4">
        <div>
          <h3 id="pendingReminderModalTitle" class="text-lg font-semibold text-slate-900">Edit reminder rule</h3>
          <p class="mt-2 text-sm text-slate-600">Update the reminder schedule for pending approvals.</p>
        </div>
        <button id="pendingReminderEditClose" class="text-xl text-slate-400 hover:text-slate-600" aria-label="Close dialog">×</button>
      </div>
      <div class="mt-4 space-y-3">
        <label class="small" style="display:block;">
          <span>Frequency</span>
          <select id="pendingReminderEditFrequency" class="muted-input">
            <option value="daily">Daily</option>
            <option value="weekly">Weekly</option>
            <option value="monthly">Monthly</option>
          </select>
        </label>
        <div class="small">
          <div class="label-with-info">
            <span>Recipient roles</span>
          </div>
          <div id="pendingReminderEditRoles" class="row wrap" style="margin-top:6px;"></div>
        </div>
        <div class="small">
          <div class="label-with-info">
            <span>Individual recipients</span>
          </div>
          <div id="pendingReminderEditRecipients" class="row wrap" style="margin-top:6px;"></div>
        </div>
        <label class="small" style="display:block;">
          <span>Reminder message</span>
          <input id="pendingReminderEditMessage" class="muted-input" />
        </label>
      </div>
      <div class="mt-6 flex flex-wrap justify-end gap-3">
        <button id="pendingReminderEditCancel" class="rounded-lg border border-slate-200 px-4 py-2 text-sm font-medium text-slate-600 hover:bg-slate-50">Cancel</button>
        <button id="pendingReminderEditSave" class="rounded-lg bg-indigo-600 px-4 py-2 text-sm font-semibold text-white hover:bg-indigo-500">Save changes</button>
      </div>
    </div>
  </div>

  <div id="pendingAgreementModal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-slate-900/50 px-4" aria-hidden="true">
    <div class="w-full max-w-lg rounded-2xl border border-slate-200 bg-white p-6 shadow-xl">
      <div class="flex items-start justify-between gap-4">
        <div>
          <h3 id="pendingAgreementModalTitle" class="text-lg font-semibold text-slate-900">Edit pending agreement</h3>
          <p id="pendingAgreementModalDescription" class="mt-2 text-sm text-slate-600">Update the details for this approval item.</p>
        </div>
        <button id="pendingAgreementEditClose" class="text-xl text-slate-400 hover:text-slate-600" aria-label="Close dialog">×</button>
      </div>
      <div class="mt-4 space-y-3">
        <label class="small" style="display:block;">
          <span>Agreement title</span>
          <input id="pendingAgreementEditTitle" class="muted-input" />
        </label>
        <label class="small" style="display:block;">
          <span>Owner</span>
          <input id="pendingAgreementEditOwner" class="muted-input" />
        </label>
        <label class="small" style="display:block;">
          <span>Owner email</span>
          <input id="pendingAgreementEditOwnerEmail" class="muted-input" list="pendingAgreementOwnerEmails" />
          <datalist id="pendingAgreementOwnerEmails"></datalist>
        </label>
        <label class="small" style="display:block;">
          <span>Due date</span>
          <input id="pendingAgreementEditDueDate" type="date" class="muted-input" />
        </label>
        <label class="small" style="display:block;">
          <span>Status</span>
          <input id="pendingAgreementEditStatus" class="muted-input" />
        </label>
        <label class="small" style="display:block;">
          <span>Linked contract</span>
          <input
            id="pendingAgreementContractSearch"
            class="muted-input"
            list="pendingAgreementContractList"
            placeholder="Search contracts by title or vendor"
          />
          <datalist id="pendingAgreementContractList"></datalist>
        </label>
        <div class="muted small" id="pendingAgreementContractMeta"></div>
      </div>
      <div class="mt-6 flex flex-wrap justify-end gap-3">
        <button id="pendingAgreementEditCancel" class="rounded-lg border border-slate-200 px-4 py-2 text-sm font-medium text-slate-600 hover:bg-slate-50">Cancel</button>
        <button id="pendingAgreementEditSave" class="rounded-lg bg-indigo-600 px-4 py-2 text-sm font-semibold text-white hover:bg-indigo-500">Save changes</button>
      </div>
    </div>
  </div>

  <div id="tourOverlay" class="hidden tour-overlay" aria-hidden="true">
    <div id="tourTooltip" class="tour-tooltip" role="dialog" aria-live="polite">
      <div id="tourStepLabel" class="tour-step-label">Step 1 of 5</div>
      <div id="tourTitle" class="tour-title"></div>
      <div id="tourBody" class="tour-body"></div>
      <div class="tour-actions">
        <button id="tourBack" type="button">Back</button>
        <button id="tourNext" type="button">Next</button>
        <button id="tourClose" type="button">End tour</button>
      </div>
    </div>
  </div>

  <div id="modalOverlay" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-slate-900/50 px-4" aria-hidden="true">
    <div class="w-full max-w-lg rounded-2xl border border-slate-200 bg-white p-6 shadow-xl">
      <div class="flex items-start justify-between gap-4">
        <div>
          <h3 id="modalTitle" class="text-lg font-semibold text-slate-900">Confirm action</h3>
          <p id="modalMessage" class="mt-2 text-sm text-slate-600"></p>
        </div>
        <button id="modalClose" class="text-xl text-slate-400 hover:text-slate-600" aria-label="Close dialog">×</button>
      </div>
      <div class="mt-6 flex flex-wrap justify-end gap-3">
        <button id="modalCancel" class="rounded-lg border border-slate-200 px-4 py-2 text-sm font-medium text-slate-600 hover:bg-slate-50">Cancel</button>
        <button id="modalConfirm" class="rounded-lg bg-indigo-600 px-4 py-2 text-sm font-semibold text-white hover:bg-indigo-500">Confirm</button>
      </div>
    </div>
  </div>

  <div id="authOverlay" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-slate-900/50 px-4" aria-hidden="true">
    <div class="bg-white w-full max-w-sm rounded-2xl border border-slate-200 p-6 shadow-xl">
      <div class="flex items-center justify-between">
        <h3 class="text-lg font-semibold text-slate-900">Sign in</h3>
      </div>
      <form id="authForm" class="mt-4" autocomplete="off">
        <label class="small" style="display:block; margin-bottom:8px;">
          <span>Email</span>
          <input id="authEmail" class="muted-input" type="email" placeholder="name@company.com" required />
        </label>
        <label class="small" style="display:block; margin-bottom:8px;">
          <span>Password</span>
          <input id="authPassword" class="muted-input" type="password" placeholder="••••••••" required />
        </label>
        <div class="muted small" id="authError"></div>
        <div class="inline" style="justify-content:flex-end; margin-top:12px;">
          <button id="authSubmit" type="submit">Sign in</button>
        </div>
        <div class="mt-4 flex items-center gap-3 text-xs text-slate-500">
          <span class="h-px flex-1 bg-slate-200"></span>
          <span>or</span>
          <span class="h-px flex-1 bg-slate-200"></span>
        </div>
        <button id="authMicrosoftButton" type="button" class="hidden mt-3 w-full">
          Sign in with Microsoft
        </button>
      </form>
    </div>
  </div>

  <script src="config.js"></script>
  <script src="app.js"></script>
  <div id="toastContainer" class="toast-container"></div>
</body>
</html>
